var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),BoxAlign;!function(t){t[t.left_top=0]="left_top",t[t.top=1]="top",t[t.right_top=2]="right_top",t[t.right=3]="right",t[t.right_bottom=4]="right_bottom",t[t.bottom=5]="bottom",t[t.left_bottom=6]="left_bottom",t[t.left=7]="left",t[t.center=8]="center"}(BoxAlign||(BoxAlign={}));var BaseBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(t,e,i){switch(void 0===e&&(e=BoxAlign.center),void 0===i&&(i=new egret.Point(0,0)),t&&Game.instance.uiLayer.addChild(this.maskUI),Game.instance.uiLayer.addChild(this),e){case BoxAlign.left_top:this.x=0,this.y=0;break;case BoxAlign.top:this.x=(Game.instance.stageW-this.width)/2,this.y=0;break;case BoxAlign.right_top:this.x=Game.instance.stageW-this.width,this.y=0;break;case BoxAlign.right:this.x=Game.instance.stageW-this.width,this.y=(Game.instance.stageH-this.height)/2;break;case BoxAlign.right_bottom:this.x=Game.instance.stageW-this.width,this.y=Game.instance.stageH-this.height;break;case BoxAlign.bottom:this.x=(Game.instance.stageW-this.width)/2,this.y=Game.instance.stageH-this.height;break;case BoxAlign.left_bottom:this.x=0,this.y=Game.instance.stageH-this.height;break;case BoxAlign.left:this.x=0,this.y=(Game.instance.stageH-this.height)/2;break;case BoxAlign.center:this.x=(Game.instance.stageW-this.width)/2,this.y=(Game.instance.stageH-this.height)/2}this.x+=i.x,this.y+=i.y},e.prototype.hide=function(t){void 0===t&&(t=!1),DisplayUtil.remove(this),DisplayUtil.remove(this.m_mask),t&&this.dispose()},e.prototype.dispose=function(){this.m_mask=null},Object.defineProperty(e.prototype,"maskUI",{get:function(){return null==this.m_mask&&(this.m_mask=new egret.Sprite,this.m_mask.touchEnabled=!0),this.m_mask.graphics.clear(),this.m_mask.graphics.beginFill(0,.5),this.m_mask.graphics.drawRect(0,0,Game.instance.stageW,Game.instance.stageH),this.m_mask.graphics.endFill(),this.m_mask},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(BaseBox.prototype,"BaseBox");var StepType;!function(t){t[t.wait=0]="wait",t[t.exec=1]="exec",t[t.block=2]="block"}(StepType||(StepType={}));var Step=function(){function t(){this.m_taskList=[]}return t.prototype.wait=function(t){var e=this;return this.m_taskList.push({type:StepType.wait,data:t}),egret.setTimeout(function(){e.check()},this,0),this},t.prototype.exec=function(t,e){var i=this;return this.m_taskList.push({type:StepType.exec,data:{func:t,thisObj:e}}),egret.setTimeout(function(){i.check()},this,0),this},t.prototype.block=function(t,e){var i=this;return this.m_taskList.push({type:StepType.block,data:{func:t,thisObj:e}}),egret.setTimeout(function(){i.check()},this,0),this},t.prototype.next=function(){this.m_waitting=!1,egret.clearTimeout(this.m_timeId),this.check()},t.prototype.clear=function(){this.m_waitting=!1,egret.clearTimeout(this.m_timeId),this.m_taskList.length=0},t.prototype.check=function(){if(!this.m_waitting&&this.m_taskList.length>0){var t=this.m_taskList.shift();this.checkTask(t)}},t.prototype.checkTask=function(t){t.type==StepType.wait?this.doWait(t):t.type==StepType.exec?this.doExec(t):t.type==StepType.block&&this.doBlock(t)},t.prototype.doWait=function(t){var e=this,i=t.data;this.m_waitting=!0,this.m_timeId=egret.setTimeout(function(){e.m_waitting=!1,e.check()},this,i)},t.prototype.doExec=function(t){var e=t.data.func,i=t.data.thisObj;e.call(i),this.check()},t.prototype.doBlock=function(t){this.m_waitting=!0;var e=t.data.func,i=t.data.thisObj;e.call(i)},t}();__reflect(Step.prototype,"Step");var Workflow=function(){function t(){this.m_step=new Step,this.m_list=[]}return t.prototype.addWait=function(t){this.m_list.push({type:StepType.wait,data:t})},t.prototype.addExec=function(t,e){this.m_list.push({type:StepType.exec,data:{func:t,thisObj:e}})},t.prototype.addBlock=function(t,e){this.m_list.push({type:StepType.block,data:{func:t,thisObj:e}})},t.prototype.run=function(){this.m_step.clear();for(var t=0;t<this.m_list.length;t++){var e=this.m_list[t];e.type==StepType.wait?this.m_step.wait(e.data):e.type==StepType.exec?this.m_step.exec(e.func,e.thisObj):e.type==StepType.block&&this.m_step.block(e.func,e.thisObj)}},t.prototype.next=function(){this.m_step.next()},t}();__reflect(Workflow.prototype,"Workflow");var DisplayUtil=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.createMovieClipByName=function(t){var e=RES.getRes(t+"_json"),i=RES.getRes(t+"_png"),o=new egret.MovieClipDataFactory(e,i);return new egret.MovieClip(o.generateMovieClipData(t))},t.remove=function(t){null!=t&&null!=t.parent&&t.parent.removeChild(t)},t.setSize=function(t,e,i){void 0===e&&(e=0/0),void 0===i&&(i=0/0);var o=t.scaleX,a=t.scaleY;isNaN(e)||(o=e/t.width),isNaN(i)||(a=i/t.height),t.scaleX=o,t.scaleY=a},t}();__reflect(DisplayUtil.prototype,"DisplayUtil");var Game=function(t){function e(){var i=t.call(this)||this;return i.m_state=e.GAME_INIT,i.m_rightCount=0,i.m_failCount=0,i.laveHand=Array(),i.laveHand2=Array(),i}return __extends(e,t),e.prototype.run=function(){var t=this;e.instance=this;var i=RES.getRes("config_json");this.m_qList=i.list,this.m_laveList=new Array,this.m_bgSound=new SoundPlayer,this.m_qSound=new SoundPlayer,this.m_effSound=new SoundPlayer,this.m_sceneLayer=new egret.Sprite,this.addChild(this.m_sceneLayer),this.m_roleLayer=new egret.Sprite,this.addChild(this.m_roleLayer),this.m_uiLayer=new egret.Sprite,this.m_uiLayer.touchEnabled=this.m_uiLayer.touchChildren=!0,this.addChild(this.m_uiLayer),this.m_cardManager=new CardManager,this.m_cardManager.init(i),this.m_cardManager.addEventListener("TOUCH_CARD",this.onTouchCard,this),this.m_gameScene=new GameScene,this.m_sceneLayer.addChild(this.m_gameScene),this.m_role1=new RoleView,this.m_role1.x=213,this.m_role1.y=567,this.m_roleLayer.addChild(this.m_role1),this.m_scoreBoard=new ScoreBoard,this.m_scoreBoard.show(!1,BoxAlign.right_top,new egret.Point(-50,50)),this.m_musicBtn=new MusicBtn,this.m_musicBtn.show(!1,BoxAlign.right_bottom,new egret.Point(-50,-50)),this.m_musicBtn.addEventListener(egret.Event.CHANGE,this.updateBgMusic,this),this.m_repeatBtn=DisplayUtil.createBitmapByName("repatBtn_png"),this.m_repeatBtn.touchEnabled=!0,this.m_repeatBtn.x=this.m_musicBtn.x,this.m_repeatBtn.y=this.m_musicBtn.y-120,this.uiLayer.addChild(this.m_repeatBtn),this.m_repeatBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){null!=t.m_curQuestion&&(t.m_qSound.clear(),t.m_qSound.playRes(t.m_curQuestion.audio))},this),this.m_playAgainBtn=DisplayUtil.createBitmapByName("playAgainBtn_png"),this.m_playAgainBtn.touchEnabled=!0,this.m_playAgainBtn.x=this.m_repeatBtn.x,this.m_playAgainBtn.y=this.m_repeatBtn.y,this.m_playAgainBtn.visible=!1,this.uiLayer.addChild(this.m_playAgainBtn),this.m_playAgainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.gamePlay()},this),this.m_tryAgainBtn=DisplayUtil.createBitmapByName("tryAgainBtn_png"),this.m_tryAgainBtn.touchEnabled=!0,this.m_tryAgainBtn.x=this.m_repeatBtn.x,this.m_tryAgainBtn.y=this.m_repeatBtn.y,this.m_tryAgainBtn.visible=!1,this.uiLayer.addChild(this.m_tryAgainBtn),this.m_tryAgainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.gamePlay()},this),this.addEventListener(egret.Event.ENTER_FRAME,this.onRender,this),this.m_state=e.GAME_INIT,this.m_gameStartBox=new GameStartBox,this.m_gameStartBox.once("START",this.gamePlay,this),this.m_gameStartBox.show(!0)},e.prototype.onRender=function(){this.m_state==e.GAME_PLAY},e.prototype.gamePlay=function(){this.m_state=e.GAME_PLAY,this.m_gameStartBox.hide(),this.m_role1.state=RoleState.idle,this.m_gameScene.reset(),this.updateBgMusic(),this.m_rightCount=0,this.m_failCount=0,this.m_scoreBoard.setScore(0),this.m_laveList=this.m_qList.concat(),ArrayUtil.randomSort(this.m_laveList),this.m_cardManager.reset(),this.m_cardManager.start(),this.question()},e.prototype.question=function(){this.m_answering=!1,this.m_repeatBtn.visible=!0,this.m_playAgainBtn.visible=!1,this.m_tryAgainBtn.visible=!1,0==this.m_laveList.length&&(this.m_laveList=this.m_qList.concat(),ArrayUtil.randomSort(this.m_laveList)),this.m_curQuestion=this.m_laveList.shift(),this.m_qSound.playRes(this.m_curQuestion.audio),this.m_cardManager.sortCard(),this.handRandom()},e.prototype.onTouchCard=function(t){this.m_answering||(this.m_answering=!0,this.m_repeatBtn.visible=!1,this.m_qSound.clear(),this.m_curCardView=t.data,this.stopTimer(),this.m_curCardView.cardName==this.m_curQuestion.name?this.answerRight():this.answerWrong())},e.prototype.answerRight=function(){var t=this;this.m_rightCount+=1,this.m_scoreBoard.setScore(this.m_rightCount),this.m_role1.state=RoleState.happy,this.m_curCardView.right(),this.m_effSound.clear(),this.m_effSound.playRes("dingdong_mp3"),this.m_effSound.exec(function(){t.m_rightCount>=e.WIN_NUM?(t.m_state=e.GAME_OVER,t.m_cardManager.hideCard(),t.m_gameScene.showLamp(),t.m_role1.state=RoleState.celebrate,t.m_effSound.playRes("hualala_mp3"),t.m_effSound.exec(function(){t.m_role1.state=RoleState.celebrate_mouth},t),t.m_effSound.playRes("U1SNS-OS05_mp3").playRes("U1SNS-OS06_mp3"),t.m_effSound.exec(function(){t.m_role1.state=RoleState.celebrate,t.m_playAgainBtn.visible=!0,t.submit(!0)},t)):(t.m_role1.state=RoleState.happy_mouth,t.m_effSound.playResRandom(["U1SNS-OS01_mp3","U1SNS-OS02_mp3"]),t.m_effSound.exec(function(){t.question(),t.m_role1.state=RoleState.idle},t))},this)},e.prototype.answerWrong=function(){var t=this;this.m_failCount+=1,this.m_role1.state=RoleState.sad,this.m_curCardView.wrong(),this.m_effSound.clear(),this.m_effSound.playRes("chacha_mp3"),this.m_effSound.exec(function(){t.m_failCount>=e.FAIL_NUM?(t.m_state=e.GAME_OVER,t.m_qSound.clear(),t.m_cardManager.hideCard(),t.m_gameScene.black(),t.m_role1.state=RoleState.fail,t.m_effSound.playRes("pa_mp3"),t.m_effSound.playRes("U1SNS-OS07_mp3").playRes("U1SNS-OS08_mp3"),t.m_effSound.exec(function(){t.submit(!1),t.m_tryAgainBtn.visible=!0},t)):(t.m_role1.state=RoleState.sad_mouth,t.m_effSound.playResRandom(["U1SNS-OS03_mp3","U1SNS-OS04_mp3"]),t.m_effSound.exec(function(){t.m_role1.state=RoleState.idle,t.m_qSound.playRes(t.m_curQuestion.audio).exec(function(){t.m_repeatBtn.visible=!0,t.handRandom()},self),t.m_answering=!1},t))},this)},e.prototype.updateBgMusic=function(){0==this.m_musicBtn.state?(Println("停止背景音乐"),this.m_bgSound.clear()):(Println("播放背景音乐"),this.m_bgSound.playRes("bgmusic_mp3",0))},e.prototype.stopTimer=function(){this.m_timer&&(this.m_timer.removeEventListener(egret.TimerEvent.COMPLETE,this.onTimerComplete,this),this.m_timer.stop(),this.m_timer=null)},e.prototype.startTimer=function(){this.stopTimer(),this.m_timer=new egret.Timer(3e3,1),this.m_timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.m_timer.start()},e.prototype.onTimerComplete=function(t){this.handRandom()},e.prototype.handRandom=function(){if(this.stopTimer(),0==this.laveHand.length)for(this.laveHand=[1,2,3,4],ArrayUtil.randomSort(this.laveHand);this.laveHand2[3]==this.laveHand[0];)ArrayUtil.randomSort(this.laveHand);this.laveHand2=this.laveHand.concat();var t=this.laveHand.shift();this.m_role1.setHand(t),this.m_cardManager.setLight(t),this.startTimer()},e.prototype.submit=function(t){var e=GetRequestObject();GameOver(t,function(){0==e.taskId&&(t?SetSuccessPanelVisible(!0):SetFailPanelVisible(!0))})},Object.defineProperty(e.prototype,"uiLayer",{get:function(){return this.m_uiLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sceneLayer",{get:function(){return this.m_sceneLayer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageW",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageH",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),e.WIN_NUM=6,e.FAIL_NUM=3,e.GAME_INIT="game_init",e.GAME_PLAY="game_play",e.GAME_OVER="game_over",e}(egret.Sprite);__reflect(Game.prototype,"Game");var ClockBoard=function(t){function e(){var e=t.call(this)||this,i=DisplayUtil.createBitmapByName("clock_png");return e.addChild(i),e.m_tf=new egret.TextField,e.m_tf.textColor=16711680,e.m_tf.size=56,e.m_tf.bold=!0,e.m_tf.textAlign=egret.HorizontalAlign.CENTER,e.m_tf.width=104,e.m_tf.height=66,e.m_tf.x=26,e.m_tf.y=80,e.addChild(e.m_tf),e}return __extends(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this.m_tf.text},set:function(t){this.m_tf.text=t},enumerable:!0,configurable:!0}),e}(BaseBox);__reflect(ClockBoard.prototype,"ClockBoard");var GameStartBox=function(t){function e(){var e=t.call(this)||this;return e.m_startBtn=DisplayUtil.createBitmapByName("start_png"),e.m_startBtn.$touchEnabled=!0,e.addChild(e.m_startBtn),e.m_startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.start,e),e}return __extends(e,t),e.prototype.start=function(){this.hide(),this.dispatchEvent(new egret.Event("START"))},e.prototype.dispose=function(){this.m_startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this),this.m_startBtn=null,t.prototype.dispose.call(this)},e}(BaseBox);__reflect(GameStartBox.prototype,"GameStartBox");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var MusicBtn=function(t){function e(){var e=t.call(this)||this;return e.m_state=1,e.btn=DisplayUtil.createBitmapByName("musicBtn_png"),e.addChild(e.btn),e.btn.touchEnabled=!0,e.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouchTap,e),e}return __extends(e,t),e.prototype.onTouchTap=function(){this.m_state=(this.m_state+1)%2,this.btn.texture=0==this.m_state?RES.getRes("muteBtn_png"):RES.getRes("musicBtn_png"),this.dispatchEvent(new egret.Event(egret.Event.CHANGE))},Object.defineProperty(e.prototype,"state",{get:function(){return this.m_state},enumerable:!0,configurable:!0}),e}(BaseBox);__reflect(MusicBtn.prototype,"MusicBtn");var ScoreBoard=function(t){function e(){var e=t.call(this)||this;e.scoreMax=6,e.touchCount=0;for(var i=0;i<e.scoreMax;i++){var o=DisplayUtil.createBitmapByName("starDark_png");o.name="star"+(e.scoreMax-i-1),o.y=0,o.x=i*(o.width+5),e.addChild(o),0==i&&(o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.touchCount++,e.touchCount%20==0?SetLogPanelVisible(!1):e.touchCount%10==0&&SetLogPanelVisible(!0)},e))}return e}return __extends(e,t),e.prototype.setScore=function(t){for(var e=0;e<this.scoreMax;e++){var i=this.getChildByName("star"+e),o=void 0;o=t>=e+1?RES.getRes("starLight_png"):RES.getRes("starDark_png"),i.texture=o}},e}(BaseBox);__reflect(ScoreBoard.prototype,"ScoreBoard");var ArrayUtil=function(){function t(){}return t.randomSort=function(t){var e=t.concat();for(t.length=0;e.length>0;){var i=MathUtil.random(0,e.length-1),o=e.splice(i,1)[0];t.push(o)}},t}();__reflect(ArrayUtil.prototype,"ArrayUtil");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.loadingView.x=(this.stage.stageWidth-this.loadingView.width)/2,this.loadingView.y=(this.stage.stageHeight-this.loadingView.height)/2,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){this.game=new Game,this.game.touchEnabled=!0,this.addChild(this.game),this.game.run()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var EffectUtils;!function(t){function e(t,e){if(void 0===e&&(e=1e3),null==this.rotationArr&&(this.rotationArr=[]),!this.rotationArr[t.hashCode]){null!=this.rotationArr[t.hashCode]&&this.rotationArr[t.hashCode]||(this.rotationArr[t.hashCode]=!0);var i=function(){this.rotationArr[t.hashCode]&&null!=t&&(t.rotation=0,egret.Tween.get(t).to({rotation:360},e).call(i,this))};t.rotation=0,egret.Tween.get(t).to({rotation:360},e).call(i,this)}}function i(t){null==this.rotationArr&&(this.rotationArr=[]),this.rotationArr[t.hashCode]=!1}function o(t,e){var i=80,o=t.x;egret.Tween.get(t).to({x:t.x-10},i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20},i)},this,2*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x-20},i)},this,3*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20},i)},this,4*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:o},i).call(function(){null!=e&&e()},this)},this,5*i)}function a(t,e){if(void 0===e&&(e=1),!this.isPlayEffectPlay){this.isPlayEffectPlay=!0;var i=function(){this.isPlayEffectPlay=!1},o=function(){1==e?egret.Tween.get(t).to({scaleX:1,scaleY:1,x:t.x-t.width/4,y:t.y-t.height/4},500,egret.Ease.elasticOut).call(i,this):2==e?egret.Tween.get(t).to({scaleX:1,scaleY:1,x:t.x-t.width/4,y:t.y-t.height/4},500,egret.Ease.backOut).call(i,this):3==e&&egret.Tween.get(t).to({scaleX:1,scaleY:1,x:t.x-t.width/4,y:t.y-t.height/4},100).call(i,this)};egret.Tween.get(t).to({scaleX:.5,scaleY:.5,x:t.x+t.width/4,y:t.y+t.height/4},100,egret.Ease.sineIn).call(o,this)}}function n(t){var e=function(){if(null!=t){var i=function(){t.scaleX=1,t.scaleY=1,egret.Tween.get(t).to({alpha:1},1e3).call(e,self)};t.alpha=1,egret.Tween.get(t).to({scaleX:1.5,scaleY:1.5,alpha:0},1e3).call(i,self)}};e()}function r(t,e,i){void 0===i&&(i=50);var o=function(){if(null!=t){var a=function(){egret.Tween.get(t).to({y:t.y-i},e).call(o,this)};egret.Tween.get(t).to({y:t.y+i},e).call(a,this)}};o()}function s(t,e,i){void 0===i&&(i=20);var o=function(){if(null!=t){var a=function(){egret.Tween.get(t).to({rotation:-i},e).call(o,this)};egret.Tween.get(t).to({rotation:i},e).call(a,this)}};o()}function h(t,e,i){void 0===e&&(e=""),void 0===i&&(i=200);for(var o=e.split(""),a=o.length,n=0;a>n;n++)egret.setTimeout(function(){t.appendText(o[Number(this)])},n,i*n)}t.rotationEffect=e,t.removeRotationEffect=i,t.shakeObj=o;t.playEffect=a,t.playScaleEffect=n,t.flyObj=r,t.rockObj=s,t.typerEffect=h}(EffectUtils||(EffectUtils={}));var MathUtil=function(){function t(){}return t.R2D=function(t){return 180*t/Math.PI},t.D2R=function(t){return t*Math.PI/180},t.random=function(e,i,o){if(void 0===i&&(i=0),void 0===o&&(o=1),e>i){var a=e;e=i,i=a}var n=i-e+1*o,r=Math.random()*n;return r+=e,t.floor(r,o)},t.floor=function(t,e){return void 0===e&&(e=1),Math.floor(t/e)*e},t}();__reflect(MathUtil.prototype,"MathUtil");var SoundPlayer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.exec=function(t,e){var i=this;return this.m_taskList.push({type:StepType.exec,data:{func:t,thisObj:e}}),egret.setTimeout(function(){i.check()},this,0),this},e.prototype.playResRandom=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=1);var o=MathUtil.random(0,t.length-1,1);return this.playRes(t[o],e,i)},e.prototype.playRes=function(t,e,i){var o=this;void 0===e&&(e=1),void 0===i&&(i=1);var a={type:"playRes",data:{key:t,loop:e,volume:i}};return this.m_waitting?(this.m_taskList.push(a),egret.setTimeout(function(){o.check()},this,0)):this.doPlayRes(a),this},e.prototype.checkTask=function(e){t.prototype.checkTask.call(this,e),"playRes"==e.type&&this.doPlayRes(e)},e.prototype.doPlayRes=function(t){this.m_waitting=!0;var e=t.data.key;this._loop=t.data.loop,this._volume=t.data.volume,this.stopSound(),this._sound=RES.getRes(e),this._channel=this._sound.play(0,this._loop),this._channel.volume=this._volume,this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this)},e.prototype.stopSound=function(){this._channel&&(this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onPlayComplete,this),this._channel.stop(),this._channel=null)},e.prototype.onPlayComplete=function(t){this.stopSound(),this.m_waitting=!1,this.check()},e.prototype.clear=function(){t.prototype.clear.call(this),this.stopSound()},e}(Step);__reflect(SoundPlayer.prototype,"SoundPlayer");var MyPosition=function(t){function e(e,i,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===o&&(o=0);var a=t.call(this,e,i)||this;return a.id=o,a}return __extends(e,t),e}(egret.Point);__reflect(MyPosition.prototype,"MyPosition");var CardManager=function(t){function e(){var e=t.call(this)||this;return e.POS_CONF=[new MyPosition(474,346,1),new MyPosition(824,537,2),new MyPosition(1209,462,3),new MyPosition(1566,332,4)],e._positionArr=[],e}return __extends(e,t),e.prototype.init=function(t){this.m_json=t,this.m_touchSound=new SoundPlayer,this.m_cardArr=Array();for(var e=0;e<this.POS_CONF.length;e++){var i=new CardView(t.list[e]);i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchCard,this),this.m_cardArr.push(i)}},e.prototype.sortCard=function(){ArrayUtil.randomSort(this.POS_CONF);for(var t=0;t<this.m_cardArr.length;t++){var e=this.POS_CONF[t],i=this.m_cardArr[t];i.id=e.id,i.x=e.x+125,i.y=e.y+125,Game.instance.sceneLayer.addChild(i),i.reset()}},e.prototype.setLight=function(t){for(var e=this.m_cardArr.length-1;e>=0;e--){var i=this.m_cardArr[e];i.id==t?i.light():i.dark()}},e.prototype.start=function(){this.reset(),this.sortCard()},e.prototype.onTouchCard=function(t){this.m_touchSound.clear(),this.m_touchSound.playRes("U1SNS01_mp3");var e=new egret.Event("TOUCH_CARD");e.data=t.currentTarget,this.dispatchEvent(e)},e.prototype.reset=function(){for(var t=this.m_cardArr.length-1;t>=0;t--){var e=this.m_cardArr[t];DisplayUtil.remove(e),e.reset()}},e.prototype.wrong=function(){for(var t=this.m_cardArr.length-1;t>=0;t--){var e=this.m_cardArr[t];e.wrong()}},e.prototype.hideCard=function(){for(var t=0;t<this.m_cardArr.length;t++){var e=this.m_cardArr[t];DisplayUtil.remove(e)}},e}(egret.EventDispatcher);__reflect(CardManager.prototype,"CardManager");var CardView=function(t){function e(e){var i=t.call(this)||this;i.m_data=e,i.image=e.image,i.audio=e.audio,i.cardName=e.name;var o=new egret.Shape;return o.graphics.beginFill(16777215,.5),o.graphics.drawCircle(0,0,124),o.graphics.endFill(),i.addChild(o),i.m_content=DisplayUtil.createBitmapByName(i.image),i.m_content.x=-i.m_content.width/2,i.m_content.y=-i.m_content.height/2,i.addChild(i.m_content),i.m_star=DisplayUtil.createBitmapByName("star_png"),i.m_star.x=-i.m_star.width/2,i.m_star.y=-i.m_star.height/2,i.addChild(i.m_star),i}return __extends(e,t),e.prototype.reset=function(){DisplayUtil.remove(this.m_star),this.m_content.filters=[],this.touchEnabled=!0},e.prototype.wrong=function(){var t=this;EffectUtils.shakeObj(this.m_content,function(){EffectUtils.shakeObj(t.m_content,null)})},e.prototype.right=function(){this.addChild(this.m_star)},e.prototype.light=function(){this.m_content.filters=[],this.touchEnabled=!0},e.prototype.dark=function(){var t=[1,0,0,0,-89.25,0,1,0,0,-89.25,0,0,1,0,-89.25,0,0,0,1,0];this.m_content.filters=[new egret.ColorMatrixFilter(t)],this.touchEnabled=!1},e}(egret.Sprite);__reflect(CardView.prototype,"CardView");var GameScene=function(t){function e(){var e=t.call(this)||this;return e.m_paopaoPos=[new egret.Point(399,454),new egret.Point(779,198),new egret.Point(1239,410),new egret.Point(1673,218),new egret.Point(703,815),new egret.Point(1501,859)],e.m_bg=DisplayUtil.createBitmapByName("scene_jpg"),e.addChild(e.m_bg),e.m_lamp=DisplayUtil.createMovieClipByName("lamp"),DisplayUtil.setSize(e.m_lamp,1838,207),e.m_lamp.x=24,e.m_lamp.y=112,e.m_paopaoArr=new Array,e.m_black=new egret.Sprite,e.m_black.graphics.beginFill(3355443),e.m_black.graphics.drawRect(0,0,1920,1080),e.m_black.graphics.endFill(),e}return __extends(e,t),e.prototype.showLamp=function(){this.reset(),this.addChild(this.m_lamp),this.m_lamp.gotoAndPlay("flash",-1);for(var t=function(t){var i=DisplayUtil.createMovieClipByName("paopao");i.x=e.m_paopaoPos[t].x,i.y=e.m_paopaoPos[t].y,i.scaleX=i.scaleY=MathUtil.random(.5,1.5,.1),e.m_paopaoArr.push(i),e.addChild(i),egret.Tween.get(i).wait(MathUtil.random(0,1e3,100)).call(function(){var t=MathUtil.random(1,2,1);i.gotoAndPlay("color"+t,-1)},e)},e=this,i=0;i<this.m_paopaoPos.length;i++)t(i)},e.prototype.black=function(){this.reset(),this.addChild(this.m_black)},e.prototype.reset=function(){DisplayUtil.remove(this.m_lamp),this.m_lamp.stop();for(var t=0;t<this.m_paopaoArr.length;t++){var e=this.m_paopaoArr[t];e.stop(),DisplayUtil.remove(e),egret.Tween.removeTweens(e)}this.m_paopaoArr.length=0,DisplayUtil.remove(this.m_black)},e}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");var PaoPaoView=function(t){function e(){var e=t.call(this)||this;return Math.random()>.5?e.texture=RES.getRes("paopao1_png"):e.texture=RES.getRes("paopao2_png"),e}return __extends(e,t),e}(egret.Bitmap);__reflect(PaoPaoView.prototype,"PaoPaoView");var RoleState;!function(t){t[t.idle=0]="idle",t[t.happy=1]="happy",t[t.happy_mouth=2]="happy_mouth",t[t.sad=3]="sad",t[t.sad_mouth=4]="sad_mouth",t[t.celebrate=5]="celebrate",t[t.celebrate_mouth=6]="celebrate_mouth",t[t.fail=7]="fail"}(RoleState||(RoleState={}));var RoleView=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e.m_hand=DisplayUtil.createMovieClipByName("hand"),e.m_hand.gotoAndStop(5),e.addChild(e.m_hand),e.m_roleIdle=DisplayUtil.createMovieClipByName("role_idle"),e.m_roleIdle.stop(),e.addChild(e.m_roleIdle),e.m_roleHappy=DisplayUtil.createMovieClipByName("role_happy"),e.m_roleHappy.stop(),e.m_roleSad=DisplayUtil.createMovieClipByName("role_sad"),e.m_roleSad.stop(),e.m_roleCelebrate=DisplayUtil.createMovieClipByName("role_celebrate"),e.m_roleCelebrate.stop(),e}return __extends(e,t),e.prototype.setHand=function(t){this.m_hand.gotoAndStop(t)},e.prototype.getHand=function(){return this.m_hand.currentFrame},Object.defineProperty(e.prototype,"state",{get:function(){return this.m_state},set:function(t){this.m_isChangeState=this.m_state!=t,this.m_state=t,this.m_isChangeState&&(this.m_isChangeState=!1,this.reset(),this[RoleState[this.m_state]]())},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.m_roleIdle.stop(),DisplayUtil.remove(this.m_roleIdle),this.m_roleHappy.stop(),DisplayUtil.remove(this.m_roleHappy),this.m_roleSad.stop(),DisplayUtil.remove(this.m_roleSad),this.m_roleCelebrate.stop(),DisplayUtil.remove(this.m_roleCelebrate),this.m_hand.visible=!0},e.prototype.idle=function(){this.addChild(this.m_roleIdle),this.m_roleIdle.gotoAndPlay(RoleState[RoleState.idle],-1)},e.prototype.happy=function(){this.addChild(this.m_roleHappy),this.m_roleHappy.gotoAndStop(RoleState[RoleState.happy])},e.prototype.happy_mouth=function(){this.addChild(this.m_roleHappy),this.m_roleHappy.gotoAndPlay(RoleState[RoleState.happy_mouth],-1)},e.prototype.sad=function(){this.addChild(this.m_roleSad),this.m_roleSad.gotoAndStop(RoleState[RoleState.sad])},e.prototype.sad_mouth=function(){this.addChild(this.m_roleSad),this.m_roleSad.gotoAndPlay(RoleState[RoleState.sad_mouth],-1)},e.prototype.celebrate=function(){this.addChild(this.m_roleCelebrate),this.m_roleCelebrate.gotoAndStop(RoleState[RoleState.celebrate]),this.m_hand.visible=!1},e.prototype.celebrate_mouth=function(){this.addChild(this.m_roleCelebrate),this.m_roleCelebrate.gotoAndPlay(RoleState[RoleState.celebrate_mouth],-1),this.m_hand.visible=!1},e.prototype.fail=function(){this.addChild(this.m_roleSad),this.m_roleSad.gotoAndPlay(RoleState[RoleState.fail],-1),this.m_hand.visible=!1},e}(egret.Sprite);__reflect(RoleView.prototype,"RoleView");var WindView=function(t){function e(){var e=t.call(this)||this;return e.m_view=DisplayUtil.createBitmapByName("wind_png"),e.addChild(e.m_view),e}return __extends(e,t),e.prototype.show=function(t){t.addChild(this),this.playTween()},e.prototype.playTween=function(){var t=this;this.m_view.alpha=0,this.m_view.x=398,this.m_view.y=120,egret.Tween.get(this.m_view).to({x:288.15,y:244.05,alpha:1},600).wait(300).to({x:206.2,y:356,alpha:0},400).call(function(){t.playTween()},this)},e.prototype.hide=function(){egret.Tween.removeTweens(this.m_view),DisplayUtil.remove(this)},e}(egret.Sprite);__reflect(WindView.prototype,"WindView");